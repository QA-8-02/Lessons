<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pac-Man</title>

</head>

<body>
    <canvas id="mycanvas" width="1300" height="600" style="border: 2px solid navy;"></canvas>
    <script>
        var canvas = document.getElementById('mycanvas');
        var ctx = canvas.getContext('2d');
        var x = 0;
        const NUMBER_OF_PACK = 10;
        //--------------------
        var pc = [];
        for (i = 0; i < NUMBER_OF_PACK; i++) {
            var tmpPackman = {
                x: Math.floor(Math.random() * canvas.width * 0.9) + 62,
                y: Math.floor(Math.random() * canvas.height * 0.79) + 62,
                dx: Math.round(Math.random()) + 0.5,
                dy: Math.round(Math.random()) + 0.5
            };
            pc.push(tmpPackman);
        }
        //--------------------

        //----------------------
        setInterval(update, 30);
        update();

        document.addEventListener('keydown', keyboardResponse);

        function keyboardResponse(event) {
            if (event.keyCode == 39) {//right 39
                pc[0].dx = 1;
            }
            if (event.keyCode == 37) { //left 37
                pc[0].dx = -1;
            }
            if (event.keyCode == 38) { //up 38
                pc[0].dy = -1;
            }
            if (event.keyCode == 40) { //down 40
                pc[0].dy = 1;
            }

        }

        function update() {
            x++;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            //---------------------------------------
            for (var i = 0; i < NUMBER_OF_PACK; i++) {

                if (pc[i].x <= 52 || pc[i].x >= canvas.width - 52) {
                    pc[i].dx *= -1;
                }
                if (pc[i].y <= 52 || pc[i].y >= canvas.height - 52) {
                    pc[i].dy *= -1;
                }

                // BOOM
                if (i != 0) {                    
                    if (Math.sqrt(Math.pow(pc[i].x - pc[0].x, 2) + Math.pow(pc[i].y - pc[0].y, 2)) <= 110) {
                        
                        ctx.save();
                        pc[i].x += 2000 * pc[i].dx;
                        pc[i].y += 2000 * pc[i].dy;

                        ctx.translate(pc[i].x, pc[i].y);
                        if (pc[i].dx == -1) {
                            ctx.scale(pc[i].dx, 1);
                        }
                        
                        ctx.restore();
                    }
                }             


                ctx.save();
                pc[i].x += 2 * pc[i].dx;
                pc[i].y += 2 * pc[i].dy;

                ctx.translate(pc[i].x, pc[i].y);
                if (pc[i].dx == -1) {
                    ctx.scale(pc[i].dx, 1);
                }

                // Purple Packman
                if (i == 0)
                    pacman1();
                else
                    pacman();

                ctx.restore();

            }

        }

        function pacman1() {
            ctx.beginPath();
            if (x % 15 == 0) {
                ctx.arc(0, 0, 50, 30 * Math.PI / 180, 330 * Math.PI / 180);
            }
            else {
                ctx.arc(0, 0, 50, 3 * Math.PI / 180, 357 * Math.PI / 180);
            }

            ctx.lineTo(0, 0);
            ctx.closePath();
            ctx.lineWidth = 10;
            ctx.stroke();
            ctx.fillStyle = "#F0F"
            ctx.fill();

            ctx.beginPath();
            ctx.arc(15, -25, 5, 0, 360 * Math.PI / 180);
            ctx.stroke();
            ctx.fillStyle = "#000"
            ctx.fill();
        }

        function pacman(i) {
            ctx.beginPath();
            if (x % 15 == 0) {
                ctx.arc(0, 0, 50, 30 * Math.PI / 180, 330 * Math.PI / 180);
            }
            else {
                ctx.arc(0, 0, 50, 3 * Math.PI / 180, 357 * Math.PI / 180);
            }

            ctx.lineTo(0, 0);
            ctx.closePath();
            ctx.lineWidth = 10;
            ctx.stroke();
            ctx.fillStyle = "#FF0"
            ctx.fill();

            ctx.beginPath();
            ctx.arc(15, -25, 5, 0, 360 * Math.PI / 180);
            ctx.stroke();
            ctx.fillStyle = "#000"
            ctx.fill();
        }        

    </script>
</body>

</html>